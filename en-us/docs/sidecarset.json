{
  "filename": "sidecarset.md",
  "__html": "<h1>SidecarSet</h1>\n<p>This controller leverages the mutating webhook admission controllers to automatically\ninject a sidecar container for every selected Pod when the Pod is created. The Sidecar\ninjection process is similar to the automatic sidecar injection mechanism used in\n<a href=\"https://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/\">istio</a>.</p>\n<p>Besides deployment, in the future release, SidecarSet controller will provide\nadditional capabilities such as in-place Sidecar container image upgrade\nand Sidecar container clean up if it is no longer needed.\nBasically, SidecarSet decouples the Sidecar container lifecycle\nmanagement from the main container lifecycle management.\nThe upgrade capability is under development.</p>\n<p>The SidecarSet is preferable for managing stateless sidecar containers such as\nmonitoring tools or operation agents. Its API spec is listed below:</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">type</span> SidecarSetSpec <span class=\"hljs-keyword\">struct</span> {\n    <span class=\"hljs-comment\">// selector is a label query over pods that should be injected</span>\n    Selector *metav1.LabelSelector <span class=\"hljs-string\">`json:\"selector,omitempty\"`</span>\n\n    <span class=\"hljs-comment\">// containers specifies the list of containers to be injected into the pod</span>\n    Containers []SidecarContainer <span class=\"hljs-string\">`json:\"containers,omitempty\"`</span>\n}\n\n<span class=\"hljs-keyword\">type</span> SidecarContainer <span class=\"hljs-keyword\">struct</span> {\n    corev1.Container\n}\n</code></pre>\n<p>The <code>Selector</code> selects which pods to inject the sidecar container using the label\nselector and the <code>Containers</code> specifies the list of containers to be injected.</p>\n<p>Note that the injection happens at Pod creation time and only Pod spec is updated.\nThe workload template spec will not be updated.</p>\n<h2>Example</h2>\n<h3>Create a SidecarSet</h3>\n<p>The <code>sidecarset.yaml</code> file below describes a SidecarSet that contains a sidecar container named <code>sidecar1</code></p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-comment\"># sidecarset.yaml</span>\n<span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">apps.kruise.io/v1alpha1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">SidecarSet</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">test-sidecarset</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  selector:</span>\n<span class=\"hljs-attr\">    matchLabels:</span>\n<span class=\"hljs-attr\">      app:</span> <span class=\"hljs-string\">nginx</span>\n<span class=\"hljs-attr\">  containers:</span>\n<span class=\"hljs-attr\">  - name:</span> <span class=\"hljs-string\">sidecar1</span>\n<span class=\"hljs-attr\">    image:</span> <span class=\"hljs-attr\">centos:7</span>\n<span class=\"hljs-attr\">    command:</span> <span class=\"hljs-string\">[\"sleep\",</span> <span class=\"hljs-string\">\"999d\"</span><span class=\"hljs-string\">]</span> <span class=\"hljs-comment\"># do nothing at all </span>\n</code></pre>\n<p>Create a SidecarSet based on the YAML file:</p>\n<pre><code>kubectl apply -f sidecarset.yaml\n</code></pre>\n<h3>Create a Pod</h3>\n<p>Create a pod that matches the sidecarset's selector:</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">apiVersion:</span> <span class=\"hljs-string\">v1</span>\n<span class=\"hljs-attr\">kind:</span> <span class=\"hljs-string\">Pod</span>\n<span class=\"hljs-attr\">metadata:</span>\n<span class=\"hljs-attr\">  labels:</span>\n<span class=\"hljs-attr\">    app:</span> <span class=\"hljs-string\">nginx</span> <span class=\"hljs-comment\"># matches the SidecarSet's selector</span>\n<span class=\"hljs-attr\">  name:</span> <span class=\"hljs-string\">test-pod</span>\n<span class=\"hljs-attr\">spec:</span>\n<span class=\"hljs-attr\">  containers:</span>\n<span class=\"hljs-attr\">  - name:</span> <span class=\"hljs-string\">app</span>\n<span class=\"hljs-attr\">    image:</span> <span class=\"hljs-attr\">nginx:1.15.1</span>\n</code></pre>\n<p>Create this pod and now you will find it's injected with <code>sidecar1</code>:</p>\n<pre><code># kubectl get pod\nNAME       READY   STATUS    RESTARTS   AGE\ntest-pod   2/2     Running   0          118s\n</code></pre>\n<p>In the meantime, the SidecarSet status updated:</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-comment\"># kubectl get sidecarset test-sidecarset -o yaml | grep -A4 status</span>\n<span class=\"hljs-attr\">status:</span>\n<span class=\"hljs-attr\">  matchedPods:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">  observedGeneration:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">  readyPods:</span> <span class=\"hljs-number\">1</span>\n<span class=\"hljs-attr\">  updatedPods:</span> <span class=\"hljs-number\">1</span>\n</code></pre>\n",
  "link": "/en-us/docs/sidecarset.html",
  "meta": {}
}