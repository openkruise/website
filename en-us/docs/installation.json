{
  "filename": "installation.md",
  "__html": "<h1 id=\"install-openkruise\">Install OpenKruise <a class=\"header-anchor\" href=\"#install-openkruise\">#</a></h1>\n<p>Although OpenKruise now can work with Kubernetes version &gt;= <code>1.13</code>, we strongly recommend you to use Kruise with <strong>Kubernetes version &gt;= 1.16</strong>.</p>\n<p>Note that:</p>\n<ol>\n<li>For Kubernetes 1.13 and 1.14, users must enable <code>CustomResourceWebhookConversion</code> feature-gate in kube-apiserver before install or upgrade Kruise.</li>\n<li>Currently Kruise can not be installed into Kubernetes 1.22, for it has dropped v1beta1 version of some resources like CRD/WebhookConfiguration.\nThe comming Kruise v1.0 will fix it and do not support Kubernetes version lower than 1.16 any more.</li>\n</ol>\n<h2 id=\"install-with-helm-charts\">Install with helm charts <a class=\"header-anchor\" href=\"#install-with-helm-charts\">#</a></h2>\n<p>Kruise can be simply installed by helm v3.1+, which is a simple command-line tool and you can get it from <a href=\"https://github.com/helm/helm/releases\">here</a>.</p>\n<pre><code class=\"language-bash\"><span class=\"hljs-comment\"># Kubernetes 1.13 and 1.14</span>\nhelm install kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz --<span class=\"hljs-built_in\">disable</span>-openapi-validation\n\n<span class=\"hljs-comment\"># Kubernetes 1.15 and newer versions</span>\nhelm install kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz\n</code></pre>\n<h2 id=\"upgrade-with-helm-charts\">Upgrade with helm charts <a class=\"header-anchor\" href=\"#upgrade-with-helm-charts\">#</a></h2>\n<p>If you are using Kruise with an old version, it is recommended that you should upgrade to the latest version for safety and more features:</p>\n<pre><code class=\"language-bash\"><span class=\"hljs-comment\"># Kubernetes 1.13 and 1.14</span>\nhelm upgrade kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz --<span class=\"hljs-built_in\">disable</span>-openapi-validation\n\n<span class=\"hljs-comment\"># Kubernetes 1.15 and newer versions</span>\nhelm upgrade kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz\n</code></pre>\n<p>Note that:</p>\n<ol>\n<li>Before upgrade, you <strong>must</strong> firstly read the <a href=\"https://github.com/openkruise/kruise/blob/master/CHANGELOG.md\">Change Log</a>\nto make sure that you have understand the breaking changes in the new version.</li>\n<li>If you want to drop the chart parameters you configured for the old release or set some new parameters,\nit is recommended to add <code>--reset-values</code> flag in <code>helm upgrade</code> command.</li>\n</ol>\n<h2 id=\"options\">Options <a class=\"header-anchor\" href=\"#options\">#</a></h2>\n<p>Note that installing this chart directly means it will use the default template values for Kruise.</p>\n<p>You may have to set your specific configurations if it is deployed into a production cluster, or you want to configure feature-gates.</p>\n<h3 id=\"optional%3A-chart-parameters\">Optional: chart parameters <a class=\"header-anchor\" href=\"#optional%3A-chart-parameters\">#</a></h3>\n<p>The following table lists the configurable parameters of the chart and their default values.</p>\n<table>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Description</th>\n<th>Default</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>featureGates</code></td>\n<td>Feature gates for Kruise, empty string means all by default</td>\n<td>``</td>\n</tr>\n<tr>\n<td><code>installation.namespace</code></td>\n<td>namespace for kruise installation</td>\n<td><code>kruise-system</code></td>\n</tr>\n<tr>\n<td><code>manager.log.level</code></td>\n<td>Log level that kruise-manager printed</td>\n<td><code>4</code></td>\n</tr>\n<tr>\n<td><code>manager.replicas</code></td>\n<td>Replicas of kruise-controller-manager deployment</td>\n<td><code>2</code></td>\n</tr>\n<tr>\n<td><code>manager.image.repository</code></td>\n<td>Repository for kruise-manager image</td>\n<td><code>openkruise/kruise-manager</code></td>\n</tr>\n<tr>\n<td><code>manager.image.tag</code></td>\n<td>Tag for kruise-manager image</td>\n<td><code>v0.10.0</code></td>\n</tr>\n<tr>\n<td><code>manager.resources.limits.cpu</code></td>\n<td>CPU resource limit of kruise-manager container</td>\n<td><code>100m</code></td>\n</tr>\n<tr>\n<td><code>manager.resources.limits.memory</code></td>\n<td>Memory resource limit of kruise-manager container</td>\n<td><code>256Mi</code></td>\n</tr>\n<tr>\n<td><code>manager.resources.requests.cpu</code></td>\n<td>CPU resource request of kruise-manager container</td>\n<td><code>100m</code></td>\n</tr>\n<tr>\n<td><code>manager.resources.requests.memory</code></td>\n<td>Memory resource request of kruise-manager container</td>\n<td><code>256Mi</code></td>\n</tr>\n<tr>\n<td><code>manager.metrics.port</code></td>\n<td>Port of metrics served</td>\n<td><code>8080</code></td>\n</tr>\n<tr>\n<td><code>manager.webhook.port</code></td>\n<td>Port of webhook served</td>\n<td><code>9443</code></td>\n</tr>\n<tr>\n<td><code>manager.nodeAffinity</code></td>\n<td>Node affinity policy for kruise-manager pod</td>\n<td><code>{}</code></td>\n</tr>\n<tr>\n<td><code>manager.nodeSelector</code></td>\n<td>Node labels for kruise-manager pod</td>\n<td><code>{}</code></td>\n</tr>\n<tr>\n<td><code>manager.tolerations</code></td>\n<td>Tolerations for kruise-manager pod</td>\n<td><code>[]</code></td>\n</tr>\n<tr>\n<td><code>daemon.log.level</code></td>\n<td>Log level that kruise-daemon printed</td>\n<td><code>4</code></td>\n</tr>\n<tr>\n<td><code>daemon.port</code></td>\n<td>Port of metrics and healthz that kruise-daemon served</td>\n<td><code>10221</code></td>\n</tr>\n<tr>\n<td><code>daemon.resources.limits.cpu</code></td>\n<td>CPU resource limit of kruise-daemon container</td>\n<td><code>50m</code></td>\n</tr>\n<tr>\n<td><code>daemon.resources.limits.memory</code></td>\n<td>Memory resource limit of kruise-daemon container</td>\n<td><code>128Mi</code></td>\n</tr>\n<tr>\n<td><code>daemon.resources.requests.cpu</code></td>\n<td>CPU resource request of kruise-daemon container</td>\n<td><code>0</code></td>\n</tr>\n<tr>\n<td><code>daemon.resources.requests.memory</code></td>\n<td>Memory resource request of kruise-daemon container</td>\n<td><code>0</code></td>\n</tr>\n<tr>\n<td><code>daemon.affinity</code></td>\n<td>Affinity policy for kruise-daemon pod</td>\n<td><code>{}</code></td>\n</tr>\n<tr>\n<td><code>daemon.socketLocation</code></td>\n<td>Location of the container manager control socket</td>\n<td><code>/var/run</code></td>\n</tr>\n<tr>\n<td><code>webhookConfiguration.failurePolicy.pods</code></td>\n<td>The failurePolicy for pods in mutating webhook configuration</td>\n<td><code>Ignore</code></td>\n</tr>\n<tr>\n<td><code>webhookConfiguration.timeoutSeconds</code></td>\n<td>The timeoutSeconds for all webhook configuration</td>\n<td><code>30</code></td>\n</tr>\n<tr>\n<td><code>crds.managed</code></td>\n<td>Kruise will not install CRDs with chart if this is false</td>\n<td><code>true</code></td>\n</tr>\n</tbody>\n</table>\n<p>Specify each parameter using the <code>--set key=value[,key=value]</code> argument to <code>helm install</code> or <code>helm upgrade</code>.</p>\n<h3 id=\"optional%3A-feature-gate\">Optional: feature-gate <a class=\"header-anchor\" href=\"#optional%3A-feature-gate\">#</a></h3>\n<p>Feature-gate controls some influential features in Kruise:</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n<th>Default</th>\n<th>Effect (if closed)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>PodWebhook</code></td>\n<td>Whether to open a webhook for Pod <strong>create</strong></td>\n<td><code>true</code></td>\n<td>SidecarSet/KruisePodReadinessGate disabled</td>\n</tr>\n<tr>\n<td><code>KruiseDaemon</code></td>\n<td>Whether to deploy <code>kruise-daemon</code> DaemonSet</td>\n<td><code>true</code></td>\n<td>ImagePulling/ContainerRecreateRequest disabled</td>\n</tr>\n<tr>\n<td><code>DaemonWatchingPod</code></td>\n<td>Should each <code>kruise-daemon</code> watch pods on the same node</td>\n<td><code>true</code></td>\n<td>For in-place update with same imageID or env from labels/annotations</td>\n</tr>\n<tr>\n<td><code>CloneSetShortHash</code></td>\n<td>Enables CloneSet controller only set revision hash name to pod label</td>\n<td><code>false</code></td>\n<td>CloneSet name can not be longer than 54 characters</td>\n</tr>\n<tr>\n<td><code>KruisePodReadinessGate</code></td>\n<td>Enables Kruise webhook to inject 'KruisePodReady' readiness-gate to all Pods during creation</td>\n<td><code>false</code></td>\n<td>The readiness-gate will only be injected to Pods created by Kruise workloads</td>\n</tr>\n<tr>\n<td><code>PreDownloadImageForInPlaceUpdate</code></td>\n<td>Enables CloneSet controller to create ImagePullJobs to pre-download images for in-place update</td>\n<td><code>false</code></td>\n<td>No image pre-download for in-place update</td>\n</tr>\n<tr>\n<td><code>CloneSetPartitionRollback</code></td>\n<td>Enables CloneSet controller to rollback Pods to currentRevision when number of updateRevision pods is bigger than (replicas - partition)</td>\n<td><code>false</code></td>\n<td>CloneSet will only update Pods to updateRevision</td>\n</tr>\n<tr>\n<td><code>ResourcesDeletionProtection</code></td>\n<td>Enables protection for resources deletion</td>\n<td><code>false</code></td>\n<td>No protection for resources deletion</td>\n</tr>\n<tr>\n<td><code>TemplateNoDefaults</code></td>\n<td>Whether to disable defaults injection for pod/pvc template in workloads</td>\n<td><code>false</code></td>\n<td>Should not close this feature if it has open</td>\n</tr>\n<tr>\n<td><code>PodUnavailableBudgetDeleteGate</code></td>\n<td>Enables PodUnavailableBudget for pod deletion, eviction</td>\n<td><code>false</code></td>\n<td>No protection for pod deletion, eviction</td>\n</tr>\n<tr>\n<td><code>PodUnavailableBudgetUpdateGate</code></td>\n<td>Enables PodUnavailableBudget for pod.Spec update</td>\n<td><code>false</code></td>\n<td>No protection for in-place update</td>\n</tr>\n<tr>\n<td><code>WorkloadSpread</code></td>\n<td>Enables WorkloadSpread to manage multi-domain and elastic deploy</td>\n<td><code>false</code></td>\n<td>WorkloadSpread disabled</td>\n</tr>\n</tbody>\n</table>\n<p>If you want to configure the feature-gate, just set the parameter when install or upgrade. Such as:</p>\n<pre><code class=\"language-bash\">$ helm install kruise https://... --<span class=\"hljs-built_in\">set</span> featureGates=<span class=\"hljs-string\">\"ResourcesDeletionProtection=true\\,PreDownloadImageForInPlaceUpdate=true\"</span>\n</code></pre>\n<p>If you want to enable all feature-gates, set the parameter as <code>featureGates=AllAlpha=true</code>.</p>\n<h3 id=\"optional%3A-the-local-image-for-china\">Optional: the local image for China <a class=\"header-anchor\" href=\"#optional%3A-the-local-image-for-china\">#</a></h3>\n<p>If you are in China and have problem to pull image from official DockerHub, you can use the registry hosted on Alibaba Cloud:</p>\n<pre><code class=\"language-bash\">$ helm install kruise https://... --<span class=\"hljs-built_in\">set</span>  manager.image.repository=openkruise-registry.cn-hangzhou.cr.aliyuncs.com/openkruise/kruise-manager\n</code></pre>\n<h2 id=\"uninstall\">Uninstall <a class=\"header-anchor\" href=\"#uninstall\">#</a></h2>\n<p>Note that this will lead to all resources created by Kruise, including webhook configurations, services, namespace, CRDs, CR instances and Pods managed by Kruise controller, to be deleted!</p>\n<p>Please do this ONLY when you fully understand the consequence.</p>\n<p>To uninstall kruise if it is installed with helm charts:</p>\n<pre><code class=\"language-bash\">$ helm uninstall kruise\nrelease <span class=\"hljs-string\">\"kruise\"</span> uninstalled\n</code></pre>\n",
  "link": "/en-us/docs/installation.html",
  "meta": {
    "title": "Installation"
  }
}