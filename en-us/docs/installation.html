<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="installation" />
	<meta name="description" content="installation" />
	<!-- 网页标签标题 -->
	<title>Installation</title>
	<link rel="shortcut icon" href="/img/kruise.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/en-us/index.html"><img class="logo" src="/img/kruise_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">中</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/en-us/index.html" target="_self">HOME</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/en-us/docs/what_is_openkruise.html" target="_self">DOCS</a></li><li class="menu-item menu-item-normal"><a href="/en-us/blog/index.html" target="_self">BLOG</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>Documentation</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Quick start</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/what_is_openkruise.html" target="_self">What is OpenKruise</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/installation.html" target="_self">Installation</a></li></ul></li><li class="menu-item menu-item-level-1"><span>Basic</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/cloneset.html" target="_self">CloneSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/advanced_statefulset.html" target="_self">Advanced StatefulSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/sidecarset.html" target="_self">SidecarSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/advanced_daemonset.html" target="_self">Advanced DaemonSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/workloadspread.html" target="_self">WorkloadSpread</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/uniteddeployment.html" target="_self">UnitedDeployment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/broadcastjob.html" target="_self">BroadcastJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/advancedcronjob.html" target="_self">AdvancedCronJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/imagepulljob.html" target="_self">ImagePullJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/containerrecreaterequest.html" target="_self">ContainerRecreateRequest</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/deletion_protection.html" target="_self">Deletion Protection</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/podunavailablebudget.html" target="_self">PodUnavailableBudget</a></li></ul></li><li class="menu-item menu-item-level-1"><span>Reference</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/components.html" target="_self">Components</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/go_client.html" target="_self">Golang Client</a></li></ul></li><li class="menu-item menu-item-level-1"><span>Contribution</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="https://github.com/openkruise/kruise/blob/master/CONTRIBUTING.md" target="_self">Guidebook</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1 id="install-openkruise">Install OpenKruise <a class="header-anchor" href="#install-openkruise">#</a></h1>
<p>Although OpenKruise now can work with Kubernetes version &gt;= <code>1.13</code>, we strongly recommend you to use Kruise with <strong>Kubernetes version &gt;= 1.16</strong>.</p>
<p>Note that:</p>
<ol>
<li>For Kubernetes 1.13 and 1.14, users must enable <code>CustomResourceWebhookConversion</code> feature-gate in kube-apiserver before install or upgrade Kruise.</li>
<li>Currently Kruise can not be installed into Kubernetes 1.22, for it has dropped v1beta1 version of some resources like CRD/WebhookConfiguration.
The comming Kruise v1.0 will fix it and do not support Kubernetes version lower than 1.16 any more.</li>
</ol>
<h2 id="install-with-helm-charts">Install with helm charts <a class="header-anchor" href="#install-with-helm-charts">#</a></h2>
<p>Kruise can be simply installed by helm v3.1+, which is a simple command-line tool and you can get it from <a href="https://github.com/helm/helm/releases">here</a>.</p>
<pre><code class="language-bash"><span class="hljs-comment"># Kubernetes 1.13 and 1.14</span>
helm install kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz --<span class="hljs-built_in">disable</span>-openapi-validation

<span class="hljs-comment"># Kubernetes 1.15 and newer versions</span>
helm install kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz
</code></pre>
<h2 id="upgrade-with-helm-charts">Upgrade with helm charts <a class="header-anchor" href="#upgrade-with-helm-charts">#</a></h2>
<p>If you are using Kruise with an old version, it is recommended that you should upgrade to the latest version for safety and more features:</p>
<pre><code class="language-bash"><span class="hljs-comment"># Kubernetes 1.13 and 1.14</span>
helm upgrade kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz --<span class="hljs-built_in">disable</span>-openapi-validation

<span class="hljs-comment"># Kubernetes 1.15 and newer versions</span>
helm upgrade kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz
</code></pre>
<p>Note that:</p>
<ol>
<li>Before upgrade, you <strong>must</strong> firstly read the <a href="https://github.com/openkruise/kruise/blob/master/CHANGELOG.md">Change Log</a>
to make sure that you have understand the breaking changes in the new version.</li>
<li>If you want to drop the chart parameters you configured for the old release or set some new parameters,
it is recommended to add <code>--reset-values</code> flag in <code>helm upgrade</code> command.</li>
</ol>
<h2 id="options">Options <a class="header-anchor" href="#options">#</a></h2>
<p>Note that installing this chart directly means it will use the default template values for Kruise.</p>
<p>You may have to set your specific configurations if it is deployed into a production cluster, or you want to configure feature-gates.</p>
<h3 id="optional%3A-chart-parameters">Optional: chart parameters <a class="header-anchor" href="#optional%3A-chart-parameters">#</a></h3>
<p>The following table lists the configurable parameters of the chart and their default values.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>featureGates</code></td>
<td>Feature gates for Kruise, empty string means all by default</td>
<td>``</td>
</tr>
<tr>
<td><code>installation.namespace</code></td>
<td>namespace for kruise installation</td>
<td><code>kruise-system</code></td>
</tr>
<tr>
<td><code>manager.log.level</code></td>
<td>Log level that kruise-manager printed</td>
<td><code>4</code></td>
</tr>
<tr>
<td><code>manager.replicas</code></td>
<td>Replicas of kruise-controller-manager deployment</td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>manager.image.repository</code></td>
<td>Repository for kruise-manager image</td>
<td><code>openkruise/kruise-manager</code></td>
</tr>
<tr>
<td><code>manager.image.tag</code></td>
<td>Tag for kruise-manager image</td>
<td><code>v0.10.0</code></td>
</tr>
<tr>
<td><code>manager.resources.limits.cpu</code></td>
<td>CPU resource limit of kruise-manager container</td>
<td><code>100m</code></td>
</tr>
<tr>
<td><code>manager.resources.limits.memory</code></td>
<td>Memory resource limit of kruise-manager container</td>
<td><code>256Mi</code></td>
</tr>
<tr>
<td><code>manager.resources.requests.cpu</code></td>
<td>CPU resource request of kruise-manager container</td>
<td><code>100m</code></td>
</tr>
<tr>
<td><code>manager.resources.requests.memory</code></td>
<td>Memory resource request of kruise-manager container</td>
<td><code>256Mi</code></td>
</tr>
<tr>
<td><code>manager.metrics.port</code></td>
<td>Port of metrics served</td>
<td><code>8080</code></td>
</tr>
<tr>
<td><code>manager.webhook.port</code></td>
<td>Port of webhook served</td>
<td><code>9443</code></td>
</tr>
<tr>
<td><code>manager.nodeAffinity</code></td>
<td>Node affinity policy for kruise-manager pod</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>manager.nodeSelector</code></td>
<td>Node labels for kruise-manager pod</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>manager.tolerations</code></td>
<td>Tolerations for kruise-manager pod</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>daemon.log.level</code></td>
<td>Log level that kruise-daemon printed</td>
<td><code>4</code></td>
</tr>
<tr>
<td><code>daemon.port</code></td>
<td>Port of metrics and healthz that kruise-daemon served</td>
<td><code>10221</code></td>
</tr>
<tr>
<td><code>daemon.resources.limits.cpu</code></td>
<td>CPU resource limit of kruise-daemon container</td>
<td><code>50m</code></td>
</tr>
<tr>
<td><code>daemon.resources.limits.memory</code></td>
<td>Memory resource limit of kruise-daemon container</td>
<td><code>128Mi</code></td>
</tr>
<tr>
<td><code>daemon.resources.requests.cpu</code></td>
<td>CPU resource request of kruise-daemon container</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>daemon.resources.requests.memory</code></td>
<td>Memory resource request of kruise-daemon container</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>daemon.affinity</code></td>
<td>Affinity policy for kruise-daemon pod</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>daemon.socketLocation</code></td>
<td>Location of the container manager control socket</td>
<td><code>/var/run</code></td>
</tr>
<tr>
<td><code>webhookConfiguration.failurePolicy.pods</code></td>
<td>The failurePolicy for pods in mutating webhook configuration</td>
<td><code>Ignore</code></td>
</tr>
<tr>
<td><code>webhookConfiguration.timeoutSeconds</code></td>
<td>The timeoutSeconds for all webhook configuration</td>
<td><code>30</code></td>
</tr>
<tr>
<td><code>crds.managed</code></td>
<td>Kruise will not install CRDs with chart if this is false</td>
<td><code>true</code></td>
</tr>
</tbody>
</table>
<p>Specify each parameter using the <code>--set key=value[,key=value]</code> argument to <code>helm install</code> or <code>helm upgrade</code>.</p>
<h3 id="optional%3A-feature-gate">Optional: feature-gate <a class="header-anchor" href="#optional%3A-feature-gate">#</a></h3>
<p>Feature-gate controls some influential features in Kruise:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Default</th>
<th>Effect (if closed)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PodWebhook</code></td>
<td>Whether to open a webhook for Pod <strong>create</strong></td>
<td><code>true</code></td>
<td>SidecarSet/KruisePodReadinessGate disabled</td>
</tr>
<tr>
<td><code>KruiseDaemon</code></td>
<td>Whether to deploy <code>kruise-daemon</code> DaemonSet</td>
<td><code>true</code></td>
<td>ImagePulling/ContainerRecreateRequest disabled</td>
</tr>
<tr>
<td><code>DaemonWatchingPod</code></td>
<td>Should each <code>kruise-daemon</code> watch pods on the same node</td>
<td><code>true</code></td>
<td>For in-place update with same imageID or env from labels/annotations</td>
</tr>
<tr>
<td><code>CloneSetShortHash</code></td>
<td>Enables CloneSet controller only set revision hash name to pod label</td>
<td><code>false</code></td>
<td>CloneSet name can not be longer than 54 characters</td>
</tr>
<tr>
<td><code>KruisePodReadinessGate</code></td>
<td>Enables Kruise webhook to inject 'KruisePodReady' readiness-gate to all Pods during creation</td>
<td><code>false</code></td>
<td>The readiness-gate will only be injected to Pods created by Kruise workloads</td>
</tr>
<tr>
<td><code>PreDownloadImageForInPlaceUpdate</code></td>
<td>Enables CloneSet controller to create ImagePullJobs to pre-download images for in-place update</td>
<td><code>false</code></td>
<td>No image pre-download for in-place update</td>
</tr>
<tr>
<td><code>CloneSetPartitionRollback</code></td>
<td>Enables CloneSet controller to rollback Pods to currentRevision when number of updateRevision pods is bigger than (replicas - partition)</td>
<td><code>false</code></td>
<td>CloneSet will only update Pods to updateRevision</td>
</tr>
<tr>
<td><code>ResourcesDeletionProtection</code></td>
<td>Enables protection for resources deletion</td>
<td><code>false</code></td>
<td>No protection for resources deletion</td>
</tr>
<tr>
<td><code>TemplateNoDefaults</code></td>
<td>Whether to disable defaults injection for pod/pvc template in workloads</td>
<td><code>false</code></td>
<td>Should not close this feature if it has open</td>
</tr>
<tr>
<td><code>PodUnavailableBudgetDeleteGate</code></td>
<td>Enables PodUnavailableBudget for pod deletion, eviction</td>
<td><code>false</code></td>
<td>No protection for pod deletion, eviction</td>
</tr>
<tr>
<td><code>PodUnavailableBudgetUpdateGate</code></td>
<td>Enables PodUnavailableBudget for pod.Spec update</td>
<td><code>false</code></td>
<td>No protection for in-place update</td>
</tr>
<tr>
<td><code>WorkloadSpread</code></td>
<td>Enables WorkloadSpread to manage multi-domain and elastic deploy</td>
<td><code>false</code></td>
<td>WorkloadSpread disabled</td>
</tr>
</tbody>
</table>
<p>If you want to configure the feature-gate, just set the parameter when install or upgrade. Such as:</p>
<pre><code class="language-bash">$ helm install kruise https://... --<span class="hljs-built_in">set</span> featureGates=<span class="hljs-string">"ResourcesDeletionProtection=true\,PreDownloadImageForInPlaceUpdate=true"</span>
</code></pre>
<p>If you want to enable all feature-gates, set the parameter as <code>featureGates=AllAlpha=true</code>.</p>
<h3 id="optional%3A-the-local-image-for-china">Optional: the local image for China <a class="header-anchor" href="#optional%3A-the-local-image-for-china">#</a></h3>
<p>If you are in China and have problem to pull image from official DockerHub, you can use the registry hosted on Alibaba Cloud:</p>
<pre><code class="language-bash">$ helm install kruise https://... --<span class="hljs-built_in">set</span>  manager.image.repository=openkruise-registry.cn-hangzhou.cr.aliyuncs.com/openkruise/kruise-manager
</code></pre>
<h2 id="uninstall">Uninstall <a class="header-anchor" href="#uninstall">#</a></h2>
<p>Note that this will lead to all resources created by Kruise, including webhook configurations, services, namespace, CRDs, CR instances and Pods managed by Kruise controller, to be deleted!</p>
<p>Please do this ONLY when you fully understand the consequence.</p>
<p>To uninstall kruise if it is installed with helm charts:</p>
<pre><code class="language-bash">$ helm uninstall kruise
release <span class="hljs-string">"kruise"</span> uninstalled
</code></pre>
</div></section><footer class="footer-container"><div class="cloud-native"><div class="container"><img src="https://d33wubrfki0l68.cloudfront.net/ea0d91fac8683c38ea9a1fb8a4e9914627ac6aae/8efa9/img/logos/cloud-native-computing.svg"/><p>We are a <a href="https://www.cncf.io">Cloud Native Computing Foundation</a> sandbox project.</p></div></div><div class="copyright"><span>Copyright © 2021 The OpenKruise Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage">https://www.linuxfoundation.org/trademark-usage</a></span></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>