{
  "filename": "go_client.md",
  "__html": "<h1 id=\"golang-client\">Golang client <a class=\"header-anchor\" href=\"#golang-client\">#</a></h1>\n<p>If you want to create/get/update/delete those OpenKruise resources in a Golang project or list-watch them using informer,\nyou may need a Golang client for OpenKruise.</p>\n<p>In that way, you should use the <a href=\"https://github.com/openkruise/kruise-api\">kruise-api</a> repository,\nwhich only includes schema definition and clientsets of Kruise.</p>\n<p><strong>DO NOT</strong> bring the whole <a href=\"https://github.com/openkruise/kruise\">kruise</a> repository as dependency into your project.</p>\n<h2 id=\"usage\">Usage <a class=\"header-anchor\" href=\"#usage\">#</a></h2>\n<p>Firstly, import <code>kruise-api</code> into your <code>go.mod</code> file (the version better to be the Kruise version you installed):</p>\n<pre><code># Note that if your code dependency has Kubernetes version &gt;= 1.18,\n# use version with '-1.18' suffix, such v0.9.0-1.18\nrequire github.com/openkruise/kruise-api v0.9.0\n</code></pre>\n<p>Then, there are two ways to use <code>kruise-api</code> in your code: use it directly or with <code>controller-runtime</code>.</p>\n<p>It is recommended that you can use it with <code>controller-runtime</code> if your project is generated by\n<a href=\"https://github.com/kubernetes-sigs/kubebuilder\">kubebuilder</a> or <a href=\"https://github.com/operator-framework/operator-sdk\">operator-sdk</a>,\nwhich means <code>controller-runtime</code> is already imported in your project.\nOtherwise, you may use it directly.</p>\n<h3 id=\"use-kruise-api-directly\">Use kruise-api directly <a class=\"header-anchor\" href=\"#use-kruise-api-directly\">#</a></h3>\n<ol>\n<li>New Kruise client using your rest config:</li>\n</ol>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseclientset <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/client/clientset/versioned\"</span>\n\n<span class=\"hljs-comment\">// cfg is the rest config defined in client-go, you should get it using kubeconfig or serviceaccount</span>\nkruiseClient := kruiseclientset.NewForConfigOrDie(cfg)\n</code></pre>\n<ol start=\"2\">\n<li>Get/List Kruise resources:</li>\n</ol>\n<pre><code class=\"language-go\">cloneSet, err := kruiseClient.AppsV1alpha1().CloneSets(namespace).Get(name, metav1.GetOptions{})\ncloneSetList, err := kruiseClient.AppsV1alpha1().CloneSets(namespace).List(metav1.ListOptions{})\n</code></pre>\n<ol start=\"3\">\n<li>Create/Update Kruise resources:</li>\n</ol>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseappsv1alpha1 <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/apps/v1alpha1\"</span>\n\ncloneSet := kruiseappsv1alpha1.CloneSet{\n    <span class=\"hljs-comment\">// ...</span>\n}\nerr = kruiseClient.AppsV1alpha1().CloneSets(namespace).Create(&amp;cloneSet, metav1.CreateOptions)\n</code></pre>\n<pre><code class=\"language-go\"><span class=\"hljs-comment\">// Get first</span>\ncloneSet, err := kruiseClient.AppsV1alpha1().CloneSets(namespace).Get(name, metav1.GetOptions{})\n<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {\n    <span class=\"hljs-keyword\">return</span> err\n}\n\n<span class=\"hljs-comment\">// Modify object, such as replicas or template</span>\ncloneSet.Spec.Replicas = utilpointer.Int32Ptr(<span class=\"hljs-number\">5</span>)\n\n<span class=\"hljs-comment\">// Update</span>\n<span class=\"hljs-comment\">// This might get conflict, should retry it</span>\n<span class=\"hljs-keyword\">if</span> err = kruiseClient.AppsV1alpha1().CloneSets(namespace).Update(&amp;cloneSet, metav1.UpdateOptions); err != <span class=\"hljs-literal\">nil</span> {\n    <span class=\"hljs-keyword\">return</span> err\n}\n</code></pre>\n<ol start=\"4\">\n<li>Watch Kruise resources:</li>\n</ol>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseinformer <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/client/informers/externalversions\"</span>\n\nkruiseInformerFactory := kruiseinformer.NewSharedInformerFactory(kruiseClient, <span class=\"hljs-number\">0</span>)\nkruiseInformerFactory.Apps().V1alpha1().CloneSets().Informer().AddEventHandler(...)\nkruiseInformerFactory.Start(...)\n</code></pre>\n<h3 id=\"use-kruise-api-with-controller-runtime\">Use kruise-api with controller-runtime <a class=\"header-anchor\" href=\"#use-kruise-api-with-controller-runtime\">#</a></h3>\n<ol>\n<li>Add kruise apis into the scheme in your <code>main.go</code></li>\n</ol>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseapi <span class=\"hljs-string\">\"github.com/openkruise/kruise-api\"</span>\n\n<span class=\"hljs-comment\">// ...</span>\n_ = kruiseapi.AddToScheme(scheme)\n</code></pre>\n<ol start=\"2\">\n<li>New client</li>\n</ol>\n<p>This is needed when use controller-runtime client directly.</p>\n<p>If your project is generated by <a href=\"https://github.com/kubernetes-sigs/kubebuilder\">kubebuilder</a> or <a href=\"https://github.com/operator-framework/operator-sdk\">operator-sdk</a>,\nyou should get the client from <code>mgr.GetClient()</code> instead of the example below.</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">\"sigs.k8s.io/controller-runtime/pkg/client\"</span>\n\napiClient, err := client.New(c, client.Options{Scheme: scheme})\n</code></pre>\n<ol start=\"3\">\n<li>Get/List</li>\n</ol>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> (\n    kruiseappsv1alpha1 <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/apps/v1alpha1\"</span>\n    <span class=\"hljs-string\">\"sigs.k8s.io/controller-runtime/pkg/client\"</span>\n)\n\ncloneSet := kruiseappsv1alpha1.CloneSet{}\nerr = apiClient.Get(context.TODO(), types.NamespacedName{Namespace: namespace, Name: name}, &amp;cloneSet)\n\ncloneSetList := kruiseappsv1alpha1.CloneSetList{}\nerr = apiClient.List(context.TODO(), &amp;cloneSetList, client.InNamespace(instance.Namespace))\n</code></pre>\n<ol start=\"4\">\n<li>Create/Update/Delete</li>\n</ol>\n<p>Create a new CloneSet:</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseappsv1alpha1 <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/apps/v1alpha1\"</span>\n\ncloneSet := kruiseappsv1alpha1.CloneSet{\n    <span class=\"hljs-comment\">// ...</span>\n}\nerr = apiClient.Create(context.TODO(), &amp;cloneSet)\n</code></pre>\n<p>Update an existing CloneSet:</p>\n<pre><code class=\"language-go\"><span class=\"hljs-keyword\">import</span> kruiseappsv1alpha1 <span class=\"hljs-string\">\"github.com/openkruise/kruise-api/apps/v1alpha1\"</span>\n\n<span class=\"hljs-comment\">// Get first</span>\ncloneSet := kruiseappsv1alpha1.CloneSet{}\n<span class=\"hljs-keyword\">if</span> err = apiClient.Get(context.TODO(), types.NamespacedName{Namespace: namespace, Name: name}, &amp;cloneSet); err != <span class=\"hljs-literal\">nil</span> {\n    <span class=\"hljs-keyword\">return</span> err\n}\n\n<span class=\"hljs-comment\">// Modify object, such as replicas or template</span>\ncloneSet.Spec.Replicas = utilpointer.Int32Ptr(<span class=\"hljs-number\">5</span>)\n\n<span class=\"hljs-comment\">// Update</span>\n<span class=\"hljs-comment\">// This might get conflict, should retry it</span>\n<span class=\"hljs-keyword\">if</span> err = apiClient.Update(context.TODO(), &amp;cloneSet); err != <span class=\"hljs-literal\">nil</span> {\n    <span class=\"hljs-keyword\">return</span> err\n}\n</code></pre>\n<ol start=\"5\">\n<li>List watch and informer</li>\n</ol>\n<p>If your project is generated by <a href=\"https://github.com/kubernetes-sigs/kubebuilder\">kubebuilder</a> or <a href=\"https://github.com/operator-framework/operator-sdk\">operator-sdk</a> and get the client from <code>mgr.GetClient()</code>,\nthen methods like <code>Get</code>/<code>List</code> have already queried from informer instead of apiserver.</p>\n",
  "link": "/en-us/docs/go_client.html",
  "meta": {
    "title": "Golang client"
  }
}