<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="workloadspread" />
	<meta name="description" content="workloadspread" />
	<!-- 网页标签标题 -->
	<title>WorkloadSpread</title>
	<link rel="shortcut icon" href="/img/kruise.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/kruise_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/what_is_openkruise.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>快速开始</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/what_is_openkruise.html" target="_self">OpenKruise 是什么</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/installation.html" target="_self">安装</a></li></ul></li><li class="menu-item menu-item-level-1"><span>基础说明</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/cloneset.html" target="_self">CloneSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advanced_statefulset.html" target="_self">Advanced StatefulSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/sidecarset.html" target="_self">SidecarSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advanced_daemonset.html" target="_self">Advanced DaemonSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/workloadspread.html" target="_self">WorkloadSpread</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/uniteddeployment.html" target="_self">UnitedDeployment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/broadcastjob.html" target="_self">BroadcastJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advancedcronjob.html" target="_self">AdvancedCronJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/imagepulljob.html" target="_self">ImagePullJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/containerrecreaterequest.html" target="_self">ContainerRecreateRequest</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/deletion_protection.html" target="_self">Deletion Protection</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/podunavailablebudget.html" target="_self">PodUnavailableBudget</a></li></ul></li><li class="menu-item menu-item-level-1"><span>参考</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/components.html" target="_self">组件</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/go_client.html" target="_self">Golang 客户端</a></li></ul></li><li class="menu-item menu-item-level-1"><span>贡献</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="https://github.com/openkruise/kruise/blob/master/CONTRIBUTING.md" target="_self">指引手册</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1 id="workloadspread">WorkloadSpread <a class="header-anchor" href="#workloadspread">#</a></h1>
<p><strong>FEATURE STATE:</strong> Kruise v0.10.0</p>
<p>WorkloadSpread能够将workload的Pod按一定规则分布到不同类型的Node节点上，赋予单一workload多区域部署和弹性部署的能力。</p>
<p>常见的一些规则包括：</p>
<ul>
<li>水平打散（比如按host、az等维度的平均打散）。</li>
<li>按指定比例打散（比如按比例部署Pod到几个指定的 az 中）。</li>
<li>带优先级的分区管理，比如：
<ul>
<li>优先部署到ecs，资源不足时部署到eci。</li>
<li>优先部署固定数量个pod到ecs，其余到eci。</li>
</ul>
</li>
<li>定制化分区管理，比如：
<ul>
<li>控制workload部署不同数量的Pod到不同的cpu架构上。</li>
<li>确保不同的cpu架构上的Pod配有不同的资源配额。</li>
</ul>
</li>
</ul>
<p>WorkloadSpread与OpenKruise社区的UnitedDeployment功能相似，每一个WorkloadSpread定义多个区域（定义为<code>subset</code>），
每个<code>subset</code>对应一个<code>maxReplicas</code>数量。WorkloadSpread利用Webhook注入<code>subset</code>定义的域信息，同时控制Pod的扩缩容顺序。
与UnitedDeployment<strong>不同</strong>的是，UnitedDeployment是帮助用户创建并管理多个workload，WorkloadSpread仅作用在单个workload之上，用户提供workload即可。</p>
<p>当前支持的workload类型：<code>CloneSet</code>、<code>Deployment</code>、<code>ReplicaSet</code>。</p>
<h2 id="workloadspread-demo">WorkloadSpread Demo <a class="header-anchor" href="#workloadspread-demo">#</a></h2>
<pre><code class="language-yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps.kruise.io/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">WorkloadSpread</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">workloadspread-demo</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">targetRef:</span>
    <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span> <span class="hljs-string">|</span> <span class="hljs-string">apps.kruise.io/v1alpha1</span>
    <span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span> <span class="hljs-string">|</span> <span class="hljs-string">CloneSet</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">workload-xxx</span>
  <span class="hljs-attr">subsets:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subset-a</span>
    <span class="hljs-attr">requiredNodeSelectorTerm:</span>
      <span class="hljs-attr">matchExpressions:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">topology.kubernetes.io/zone</span>
        <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>
        <span class="hljs-attr">values:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">zone-a</span>
   <span class="hljs-attr">preferredNodeSelectorTerms:</span>
   <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">1</span>
     <span class="hljs-attr">preference:</span>
     <span class="hljs-attr">matchExpressions:</span>
     <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">another-node-label-key</span>
       <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>
       <span class="hljs-attr">values:</span>
       <span class="hljs-bullet">-</span> <span class="hljs-string">another-node-label-value</span>
    <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">3</span>
    <span class="hljs-attr">tolertions:</span> <span class="hljs-string">[]</span>
    <span class="hljs-attr">patch:</span>
      <span class="hljs-attr">metadata:</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">xxx-specific-label:</span> <span class="hljs-string">xxx</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subset-b</span>
    <span class="hljs-attr">requiredNodeSelectorTerm:</span>
      <span class="hljs-attr">matchExpressions:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">topology.kubernetes.io/zone</span>
        <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>
        <span class="hljs-attr">values:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">zone-b</span>
  <span class="hljs-attr">scheduleStrategy:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">Adaptive</span> <span class="hljs-string">|</span> <span class="hljs-string">Fixed</span>
    <span class="hljs-attr">adaptive:</span>
      <span class="hljs-attr">rescheduleCriticalSeconds:</span> <span class="hljs-number">30</span>
</code></pre>
<p><code>targetRef</code>: 指定WorkloadSpread管理的workload。不可以变更，且一个workload只能对应一个WorkloadSpread。</p>
<h2 id="spec.subsets">spec.subsets <a class="header-anchor" href="#spec.subsets">#</a></h2>
<p><code>subsets</code>定义了多个区域(<code>subset</code>),每个区域配置不同的subset信息</p>
<h3 id="subset%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E">subset字段说明 <a class="header-anchor" href="#subset%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E">#</a></h3>
<ul>
<li>
<p><code>name</code>: subset的名称，在同一个WorkloadSpread下name唯一，代表一个topology区域。</p>
</li>
<li>
<p><code>maxReplicas</code>：该subset所期望调度的最大副本数，需为 &gt;= 0的整数。若设置为空，代表不限制subset的副本数。</p>
</li>
</ul>
<blockquote>
<p>当前版本暂不支持百分比类型。</p>
</blockquote>
<ul>
<li>
<p><code>requiredNodeSelectorTerm</code>: 强制匹配到某个zone。</p>
</li>
<li>
<p><code>preferredNodeSelectorTerms</code>: 尽量匹配到某个zone。</p>
</li>
</ul>
<p><strong>注意</strong>：requiredNodeSelectorTerm对应k8s nodeAffinity的requiredDuringSchedulingIgnoredDuringExecution。
preferredNodeSelectorTerms对应nodeAffinity preferredDuringSchedulingIgnoredDuringExecution。</p>
<ul>
<li><code>tolerations</code>: <code>subset</code>Pod的Node容忍度。</li>
</ul>
<pre><code class="language-yaml"><span class="hljs-attr">tolerations:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">"key1"</span>
  <span class="hljs-attr">operator:</span> <span class="hljs-string">"Equal"</span>
  <span class="hljs-attr">value:</span> <span class="hljs-string">"value1"</span>
  <span class="hljs-attr">effect:</span> <span class="hljs-string">"NoSchedule"</span>
</code></pre>
<ul>
<li><code>patch</code>: 定制<code>subset</code>中的Pod配置，可以是Annotations、Labels、Env等。</li>
</ul>
<p>例子：</p>
<pre><code class="language-yaml"><span class="hljs-comment"># patch pod with a topology label:</span>
<span class="hljs-attr">patch:</span>
  <span class="hljs-attr">metadata:</span>
    <span class="hljs-attr">labels:</span>
      <span class="hljs-attr">topology.application.deploy/zone:</span> <span class="hljs-string">"zone-a"</span>
</code></pre>
<pre><code class="language-yaml"><span class="hljs-comment"># patch pod container resources:</span>
<span class="hljs-attr">patch:</span>
  <span class="hljs-attr">spec:</span>
    <span class="hljs-attr">containers:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span>
      <span class="hljs-attr">resources:</span>
        <span class="hljs-attr">limit:</span>
          <span class="hljs-attr">cpu:</span> <span class="hljs-string">"2"</span>
          <span class="hljs-attr">memory:</span> <span class="hljs-string">800Mi</span>
</code></pre>
<pre><code class="language-yaml"><span class="hljs-comment"># patch pod container env with a zone name:</span>
<span class="hljs-attr">patch:</span>
  <span class="hljs-attr">spec:</span>
    <span class="hljs-attr">containers:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span>
      <span class="hljs-attr">env:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">K8S_AZ_NAME</span>
        <span class="hljs-attr">value:</span> <span class="hljs-string">zone-a</span>
</code></pre>
<h2 id="%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5">调度策略 <a class="header-anchor" href="#%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5">#</a></h2>
<p>WorkloadSpread提供了两种调度策略，默认为<code>Fixed</code>:</p>
<pre><code class="language-yaml"><span class="hljs-attr">scheduleStrategy:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">Adaptive</span> <span class="hljs-string">|</span> <span class="hljs-string">Fixed</span>
    <span class="hljs-attr">adaptive:</span>
      <span class="hljs-attr">rescheduleCriticalSeconds:</span> <span class="hljs-number">30</span>
</code></pre>
<h3 id="fixed%3A">Fixed: <a class="header-anchor" href="#fixed%3A">#</a></h3>
<p>workload严格按照<code>subsets</code>定义分布。</p>
<h3 id="adaptive">Adaptive <a class="header-anchor" href="#adaptive">#</a></h3>
<p><strong>Reschedule</strong>：Kruise检查<code>subset</code>中调度失败的Pod，若超过用户定义的时间就将其调度到其他有可用的<code>subset</code>上。</p>
<h2 id="%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82">配置要求 <a class="header-anchor" href="#%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82">#</a></h2>
<p>WorkloadSpread 功能默认是关闭的，你需要在 安装/升级 Kruise 的时候打开 feature-gate：<em>WorkloadSpread</em></p>
<pre><code class="language-bash">$ helm install kruise https://... --<span class="hljs-built_in">set</span> featureGates=<span class="hljs-string">"WorkloadSpread=true"</span>
</code></pre>
<h3 id="pod-webhook">Pod Webhook <a class="header-anchor" href="#pod-webhook">#</a></h3>
<p>WorkloadSpread利用<code>webhook</code>向Pod注入域规则。</p>
<p>如果<code>PodWebhook</code> feature-gate被设置为<code>false</code>，WorkloadSpread也将不可用。</p>
<h3 id="deletion-cost-feature">deletion-cost feature <a class="header-anchor" href="#deletion-cost-feature">#</a></h3>
<p><code>CloneSet</code>已经支持该特性。</p>
<p>其他native workload需kubernetes version &gt;= 1.21。1.21版本需要开启 <code>PodDeletionCost</code> feature-gate。自1.22起默认开启。</p>
<h2 id="%E6%89%A9%E7%BC%A9%E5%AE%B9%E9%A1%BA%E5%BA%8F%EF%BC%9A">扩缩容顺序： <a class="header-anchor" href="#%E6%89%A9%E7%BC%A9%E5%AE%B9%E9%A1%BA%E5%BA%8F%EF%BC%9A">#</a></h2>
<p>WorkloadSpread所管理的workload会按照<code>subsets</code>中定义的顺序扩缩容，<strong><code>subset</code>的顺序允许改变</strong>，即通过改变<code>subset</code>的顺序来调整扩缩容的顺序。</p>
<p>规则如下：</p>
<h3 id="%E6%89%A9%E5%AE%B9">扩容 <a class="header-anchor" href="#%E6%89%A9%E5%AE%B9">#</a></h3>
<ul>
<li>按照<code>spec.subsets</code>中<code>subset</code>定义的顺序调度Pod，当前<code>subset</code>的active Pod数量达到<code>maxReplicas</code>时再调度到下一个<code>subset</code>。</li>
</ul>
<h3 id="%E7%BC%A9%E5%AE%B9">缩容 <a class="header-anchor" href="#%E7%BC%A9%E5%AE%B9">#</a></h3>
<ul>
<li>当<code>subset</code>的副本数(active)大于定义的maxReplicas时，优先缩容多余的Pod。</li>
<li>依据<code>spec.subsets</code>中<code>subset</code>定义的顺序，后面<code>subset</code>的Pod先于前面的被删除。</li>
</ul>
<p>例如：</p>
<pre><code class="language-yaml"><span class="hljs-comment">#             subset-a   subset-b  subset-c</span>
<span class="hljs-comment"># maxReplicas    10          10        nil</span>
<span class="hljs-comment"># pods number    10          10        10</span>
<span class="hljs-comment"># 删除顺序为: c -&gt; b -&gt; a</span>

<span class="hljs-comment">#             subset-a   subset-b  subset-c</span>
<span class="hljs-comment"># maxReplicas    10          10        nil</span>
<span class="hljs-comment"># pods number    20          20        20</span>
<span class="hljs-comment"># 删除顺序为: b -&gt; a -&gt; c</span>
</code></pre>
<h2 id="feature-gates">feature-gates <a class="header-anchor" href="#feature-gates">#</a></h2>
<p>WorkloadSpread默认是关闭的，如果要开启请通过设置 feature-gates <em>WorkloadSpread</em>.</p>
<pre><code class="language-bash">$ helm install kruise https://... --<span class="hljs-built_in">set</span> featureGates=<span class="hljs-string">"WorkloadSpread=true"</span>
</code></pre>
<h2 id="%E4%BE%8B%E5%AD%90">例子 <a class="header-anchor" href="#%E4%BE%8B%E5%AD%90">#</a></h2>
<h3 id="%E5%BC%B9%E6%80%A7%E9%83%A8%E7%BD%B2">弹性部署 <a class="header-anchor" href="#%E5%BC%B9%E6%80%A7%E9%83%A8%E7%BD%B2">#</a></h3>
<p>zone-a（ack）固定100个Pod，zone-b（eci）做弹性区域</p>
<ol>
<li>创建WorkloadSpread实例</li>
</ol>
<pre><code class="language-yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps.kruise.io/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">WorkloadSpread</span>
<span class="hljs-attr">metadta:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">ws-demo</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">deploy</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">targetRef:</span> <span class="hljs-comment"># 相同namespace下的workload</span>
    <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps.kruise.io/v1alpha1</span>
    <span class="hljs-attr">kind:</span> <span class="hljs-string">CloneSet</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">cs-demo</span>
  <span class="hljs-attr">subsets:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ack</span> <span class="hljs-comment"># zone ack，最多100个副本。</span>
    <span class="hljs-attr">requiredNodeSelectorTerm:</span>
      <span class="hljs-attr">matchExpressions:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">topology.kubernetes.io/zone</span>
        <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>
        <span class="hljs-attr">values:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">ack</span>
    <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">100</span>
    <span class="hljs-attr">patch:</span> <span class="hljs-comment"># 注入label</span>
      <span class="hljs-attr">metadata:</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">topology.application.deploy/zone:</span> <span class="hljs-string">ack</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">eci</span> <span class="hljs-comment"># 弹性区域eci，副本数量不限。</span>
    <span class="hljs-attr">requiredNodeSelectorTerm:</span>
      <span class="hljs-attr">matchExpressions:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">topology.kubernetes.io/zone</span>
        <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>
        <span class="hljs-attr">values:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">eci</span>
    <span class="hljs-attr">patch:</span>
      <span class="hljs-attr">metadata:</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">topology.application.deploy/zone:</span> <span class="hljs-string">eci</span>
</code></pre>
<ol start="2">
<li>创建workload，副本数可以自由调整。</li>
</ol>
<h4 id="%E9%83%A8%E7%BD%B2%E6%95%88%E6%9E%9C">部署效果 <a class="header-anchor" href="#%E9%83%A8%E7%BD%B2%E6%95%88%E6%9E%9C">#</a></h4>
<ul>
<li>当replicas &lt;= 100 时，Pod被调度到ack上。</li>
<li>当replicas &gt; 100 时，100个在ack，多余的Pod在弹性域eci。</li>
<li>缩容时优先从弹性域eci上缩容。</li>
</ul>
<h3 id="%E5%A4%9A%E5%9F%9F%E9%83%A8%E7%BD%B2">多域部署 <a class="header-anchor" href="#%E5%A4%9A%E5%9F%9F%E9%83%A8%E7%BD%B2">#</a></h3>
<p>分别部署100个副本的Pod到两个机房（zone-a, zone-b）</p>
<ol>
<li>创建WorkloadSpread实例</li>
</ol>
<pre><code class="language-yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps.kruise.io/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">WorkloadSpread</span>
<span class="hljs-attr">metadta:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">ws-demo</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">deploy</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">targetRef:</span> <span class="hljs-comment"># 相同namespace下的workload</span>
    <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps.kruise.io/v1alpha1</span>
    <span class="hljs-attr">kind:</span> <span class="hljs-string">CloneSet</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">cs-demo</span>
  <span class="hljs-attr">subsets:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subset-a</span> <span class="hljs-comment"># 区域A，100个副本。</span>
    <span class="hljs-attr">requiredNodeSelectorTerm:</span>
      <span class="hljs-attr">matchExpressions:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">topology.kubernetes.io/zone</span>
        <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>
        <span class="hljs-attr">values:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">zone-a</span>
    <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">100</span>
    <span class="hljs-attr">patch:</span>
      <span class="hljs-attr">metadata:</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">topology.application.deploy/zone:</span> <span class="hljs-string">zone-a</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subset-b</span> <span class="hljs-comment"># 区域B，100个副本。</span>
    <span class="hljs-attr">requiredNodeSelectorTerm:</span>
      <span class="hljs-attr">matchExpressions:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">topology.kubernetes.io/zone</span>
        <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>
        <span class="hljs-attr">values:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">zone-b</span>
    <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">100</span>
    <span class="hljs-attr">patch:</span>
      <span class="hljs-attr">metadata:</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">topology.application.deploy/zone:</span> <span class="hljs-string">zone-b</span>
</code></pre>
<ol start="2">
<li>
<p>创建一个200副本的新<code>CloneSet</code>，或者对现有的<code>CloneSet</code>执行滚动更新。</p>
</li>
<li>
<p>若<code>subset</code>副本分布需要变动，先调整对应<code>subset</code>的<code>maxReplicas</code>，再调整workload副本数。</p>
</li>
</ol>
</div></section><footer class="footer-container"><div class="cloud-native"><div class="container"><img src="https://d33wubrfki0l68.cloudfront.net/ea0d91fac8683c38ea9a1fb8a4e9914627ac6aae/8efa9/img/logos/cloud-native-computing.svg"/><p>We are a <a href="https://www.cncf.io">Cloud Native Computing Foundation</a> sandbox project.</p></div></div><div class="copyright"><span>Copyright © 2021 The OpenKruise Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage">https://www.linuxfoundation.org/trademark-usage</a></span></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>