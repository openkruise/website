<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="installation" />
	<meta name="description" content="installation" />
	<!-- 网页标签标题 -->
	<title>安装</title>
	<link rel="shortcut icon" href="/img/kruise.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/kruise_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/what_is_openkruise.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>快速开始</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/what_is_openkruise.html" target="_self">OpenKruise 是什么</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/installation.html" target="_self">安装</a></li></ul></li><li class="menu-item menu-item-level-1"><span>基础说明</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/cloneset.html" target="_self">CloneSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advanced_statefulset.html" target="_self">Advanced StatefulSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/sidecarset.html" target="_self">SidecarSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advanced_daemonset.html" target="_self">Advanced DaemonSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/uniteddeployment.html" target="_self">UnitedDeployment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/broadcastjob.html" target="_self">BroadcastJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advancedcronjob.html" target="_self">AdvancedCronJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/imagepulljob.html" target="_self">ImagePullJob</a></li></ul></li><li class="menu-item menu-item-level-1"><span>参考</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/components.html" target="_self">组件</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/go_client.html" target="_self">Golang 客户端</a></li></ul></li><li class="menu-item menu-item-level-1"><span>贡献</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="https://github.com/openkruise/kruise/blob/master/CONTRIBUTING.md" target="_self">指引手册</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>安装 OpenKruise</h1>
<p>OpenKruise 要求 Kubernetes 版本高于 1.13+，注意在 1.13 和 1.14 版本中必须先在 kube-apiserver 中打开 <code>CustomResourceWebhookConversion</code> feature-gate。</p>
<h2>通过 helm charts 安装</h2>
<p>建议采用 helm v3.1+ 来安装 Kruise，helm 是一个简单的命令行工具可以从 <a href="https://github.com/helm/helm/releases">这里</a> 获取。</p>
<pre><code class="language-bash"><span class="hljs-comment"># Kubernetes 1.13 或 1.14 版本</span>
helm install kruise https://github.com/openkruise/kruise/releases/download/v0.8.0/kruise-chart.tgz --<span class="hljs-built_in">disable</span>-openapi-validation

<span class="hljs-comment"># Kubernetes 1.15 和更新的版本</span>
helm install kruise https://github.com/openkruise/kruise/releases/download/v0.8.0/kruise-chart.tgz
</code></pre>
<h2>通过 helm charts 升级</h2>
<p>如果你在使用旧版本的 Kruise，建议为了安全性和更丰富的功能，升级到最新版本：</p>
<pre><code class="language-bash"><span class="hljs-comment"># Kubernetes 1.13 and 1.14</span>
helm upgrade kruise https://github.com/openkruise/kruise/releases/download/v0.8.0/kruise-chart.tgz --<span class="hljs-built_in">disable</span>-openapi-validation

<span class="hljs-comment"># Kubernetes 1.15 and newer versions</span>
helm upgrade kruise https://github.com/openkruise/kruise/releases/download/v0.8.0/kruise-chart.tgz
</code></pre>
<p>注意：</p>
<ol>
<li>在升级之前，<strong>必须</strong> 先阅读 <a href="https://github.com/openkruise/kruise/blob/master/CHANGELOG.md">Change Log</a> ，确保你已经了解新版本的不兼容变化。</li>
<li>如果你要重置之前旧版本上用的参数或者配置一些新参数，建议在 <code>helm upgrade</code> 命令里加上 <code>--reset-values</code>。</li>
</ol>
<h2>可选项</h2>
<p>注意直接安装 chart 会使用默认的 template values，你也可以根据你的集群情况指定一些特殊配置，比如修改 resources 限制或者配置 feature-gates。</p>
<h3>可选: chart 安装参数</h3>
<p>下表展示了 chart 所有可配置的参数和它们的默认值：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>featureGates</code></td>
<td>Feature gates for Kruise, empty string means all enabled</td>
<td>``</td>
</tr>
<tr>
<td><code>manager.log.level</code></td>
<td>Log level that kruise-manager printed</td>
<td><code>4</code></td>
</tr>
<tr>
<td><code>manager.replicas</code></td>
<td>Replicas of kruise-controller-manager deployment</td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>manager.image.repository</code></td>
<td>Repository for kruise-manager image</td>
<td><code>openkruise/kruise-manager</code></td>
</tr>
<tr>
<td><code>manager.image.tag</code></td>
<td>Tag for kruise-manager image</td>
<td><code>v0.8.0</code></td>
</tr>
<tr>
<td><code>manager.resources.limits.cpu</code></td>
<td>CPU resource limit of kruise-manager container</td>
<td><code>100m</code></td>
</tr>
<tr>
<td><code>manager.resources.limits.memory</code></td>
<td>Memory resource limit of kruise-manager container</td>
<td><code>256Mi</code></td>
</tr>
<tr>
<td><code>manager.resources.requests.cpu</code></td>
<td>CPU resource request of kruise-manager container</td>
<td><code>100m</code></td>
</tr>
<tr>
<td><code>manager.resources.requests.memory</code></td>
<td>Memory resource request of kruise-manager container</td>
<td><code>256Mi</code></td>
</tr>
<tr>
<td><code>manager.metrics.port</code></td>
<td>Port of metrics served</td>
<td><code>8080</code></td>
</tr>
<tr>
<td><code>manager.webhook.port</code></td>
<td>Port of webhook served</td>
<td><code>9443</code></td>
</tr>
<tr>
<td><code>manager.nodeAffinity</code></td>
<td>Node affinity policy for kruise-manager pod</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>manager.nodeSelector</code></td>
<td>Node labels for kruise-manager pod</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>manager.tolerations</code></td>
<td>Tolerations for kruise-manager pod</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>daemon.log.level</code></td>
<td>Log level that kruise-daemon printed</td>
<td><code>4</code></td>
</tr>
<tr>
<td><code>daemon.port</code></td>
<td>Port of metrics and healthz that kruise-daemon served</td>
<td><code>10221</code></td>
</tr>
<tr>
<td><code>daemon.resources.limits.cpu</code></td>
<td>CPU resource limit of kruise-daemon container</td>
<td><code>50m</code></td>
</tr>
<tr>
<td><code>daemon.resources.limits.memory</code></td>
<td>Memory resource limit of kruise-daemon container</td>
<td><code>64Mi</code></td>
</tr>
<tr>
<td><code>daemon.resources.requests.cpu</code></td>
<td>CPU resource request of kruise-daemon container</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>daemon.resources.requests.memory</code></td>
<td>Memory resource request of kruise-daemon container</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>daemon.affinity</code></td>
<td>Affinity policy for kruise-daemon pod</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>daemon.socketLocation</code></td>
<td>Location of the container manager control socket</td>
<td><code>/var/run</code></td>
</tr>
<tr>
<td><code>webhookConfiguration.failurePolicy.pods</code></td>
<td>The failurePolicy for pods in mutating webhook configuration</td>
<td><code>Ignore</code></td>
</tr>
<tr>
<td><code>webhookConfiguration.timeoutSeconds</code></td>
<td>The timeoutSeconds for all webhook configuration</td>
<td><code>30</code></td>
</tr>
<tr>
<td><code>crds.managed</code></td>
<td>Kruise will not install CRDs with chart if this is false</td>
<td><code>true</code></td>
</tr>
</tbody>
</table>
<p>这些参数可以通过 <code>--set key=value[,key=value]</code> 参数在 <code>helm install</code> 或 <code>helm upgrade</code> 命令中生效。</p>
<h3>可选: feature-gate</h3>
<p>Feature-gate 控制了 Kruise 中一些有影响性的功能：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Default</th>
<th>Side effect (if closed)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PodWebhook</code></td>
<td>Whether to open a webhook for Pod <strong>create</strong></td>
<td><code>true</code></td>
<td>SidecarSet disabled</td>
</tr>
<tr>
<td><code>KruiseDaemon</code></td>
<td>Whether to deploy <code>kruise-daemon</code> DaemonSet</td>
<td><code>true</code></td>
<td>Image pulling disabled</td>
</tr>
</tbody>
</table>
<p>如果你要配置 feature-gate，只要在安装或升级时配置参数：</p>
<pre><code class="language-bash"><span class="hljs-comment"># one</span>
$ helm install kruise https://... --<span class="hljs-built_in">set</span> featureGates=<span class="hljs-string">"PodWebhook=false"</span>

<span class="hljs-comment"># or more</span>
$ helm install kruise https://... --<span class="hljs-built_in">set</span> featureGates=<span class="hljs-string">"PodWebhook=false\,KruiseDaemon=false"</span>
</code></pre>
<h3>可选: 中国本地镜像</h3>
<p>如果你在中国、并且很难从官方 DockerHub 上拉镜像，那么你可以使用托管在阿里云上的镜像仓库：</p>
<pre><code class="language-bash">$ helm install kruise https://... --<span class="hljs-built_in">set</span>  manager.image.repository=openkruise-registry.cn-hangzhou.cr.aliyuncs.com/openkruise/kruise-manager
</code></pre>
<h2>卸载</h2>
<p>注意：卸载会导致所有 Kruise 下的资源都会删除掉，包括 webhook configurations, services, namespace, CRDs, CR instances 以及所有 Kruise workload 下的 Pod。 请务必谨慎操作！</p>
<p>卸载使用 helm chart 安装的 Kruise：</p>
<pre><code class="language-bash">$ helm uninstall kruise
release <span class="hljs-string">"kruise"</span> uninstalled
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/kruise_gray.png"/><div class="cols-container"><div class="col col-12"><h3>Disclaimer</h3><p>OpenKruise is an open-source project under Apache License 2.0.</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/what_is_openkruise.html" target="_self">OpenKruise 是什么</a></dd><dd><a href="/zh-cn/docs/components.html" target="_self">组件</a></dd><dd><a href="https://github.com/openkruise/kruise/blob/master/CONTRIBUTING.md" target="_self">贡献指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt></dl></div></div><div class="copyright"><span>Copyright © 2019 The OpenKruise Authors, The Kubernetes Authors</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>