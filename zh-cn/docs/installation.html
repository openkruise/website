<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="installation" />
	<meta name="description" content="installation" />
	<!-- 网页标签标题 -->
	<title>安装</title>
	<link rel="shortcut icon" href="/img/kruise.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/kruise_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="/zh-cn/docs/what_is_openkruise.html" target="_self">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>快速开始</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/what_is_openkruise.html" target="_self">OpenKruise 是什么</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/installation.html" target="_self">安装</a></li></ul></li><li class="menu-item menu-item-level-1"><span>基础说明</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/cloneset.html" target="_self">CloneSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advanced_statefulset.html" target="_self">Advanced StatefulSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/sidecarset.html" target="_self">SidecarSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advanced_daemonset.html" target="_self">Advanced DaemonSet</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/workloadspread.html" target="_self">WorkloadSpread</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/uniteddeployment.html" target="_self">UnitedDeployment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/broadcastjob.html" target="_self">BroadcastJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/advancedcronjob.html" target="_self">AdvancedCronJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/imagepulljob.html" target="_self">ImagePullJob</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/containerrecreaterequest.html" target="_self">ContainerRecreateRequest</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/deletion_protection.html" target="_self">Deletion Protection</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/podunavailablebudget.html" target="_self">PodUnavailableBudget</a></li></ul></li><li class="menu-item menu-item-level-1"><span>参考</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/components.html" target="_self">组件</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/go_client.html" target="_self">Golang 客户端</a></li></ul></li><li class="menu-item menu-item-level-1"><span>贡献</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="https://github.com/openkruise/kruise/blob/master/CONTRIBUTING.md" target="_self">指引手册</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1 id="%E5%AE%89%E8%A3%85-openkruise">安装 OpenKruise <a class="header-anchor" href="#%E5%AE%89%E8%A3%85-openkruise">#</a></h1>
<p>尽管目前 OpenKruise 能够兼容 Kubernetes &gt;= 1.13 版本的集群，但我们强烈建议在 <strong>Kubernetes &gt;= 1.16</strong> 以上版本的集群中使用。</p>
<p>注意:</p>
<ol>
<li>在 1.13 和 1.14 版本中必须先在 kube-apiserver 中打开 <code>CustomResourceWebhookConversion</code> feature-gate。</li>
<li>由于 Kubernetes 1.22 版本中去除了 CRD/WebhookConfiguration 等资源的 v1beta1 版本，目前 Kruise 无法部署到该版本的集群中。
即将到来的 Kruise v1.0 会解决这个兼容性问题，并不再支持 Kubernetes 1.16 之前的版本。</li>
</ol>
<h2 id="%E9%80%9A%E8%BF%87-helm-charts-%E5%AE%89%E8%A3%85">通过 helm charts 安装 <a class="header-anchor" href="#%E9%80%9A%E8%BF%87-helm-charts-%E5%AE%89%E8%A3%85">#</a></h2>
<p>建议采用 helm v3.1+ 来安装 Kruise，helm 是一个简单的命令行工具可以从 <a href="https://github.com/helm/helm/releases">这里</a> 获取。</p>
<pre><code class="language-bash"><span class="hljs-comment"># Kubernetes 1.13 或 1.14 版本</span>
helm install kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz --<span class="hljs-built_in">disable</span>-openapi-validation

<span class="hljs-comment"># Kubernetes 1.15 和更新的版本</span>
helm install kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz
</code></pre>
<h2 id="%E9%80%9A%E8%BF%87-helm-charts-%E5%8D%87%E7%BA%A7">通过 helm charts 升级 <a class="header-anchor" href="#%E9%80%9A%E8%BF%87-helm-charts-%E5%8D%87%E7%BA%A7">#</a></h2>
<p>如果你在使用旧版本的 Kruise，建议为了安全性和更丰富的功能，升级到最新版本：</p>
<pre><code class="language-bash"><span class="hljs-comment"># Kubernetes 1.13 and 1.14</span>
helm upgrade kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz --<span class="hljs-built_in">disable</span>-openapi-validation

<span class="hljs-comment"># Kubernetes 1.15 and newer versions</span>
helm upgrade kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz
</code></pre>
<p>注意：</p>
<ol>
<li>在升级之前，<strong>必须</strong> 先阅读 <a href="https://github.com/openkruise/kruise/blob/master/CHANGELOG.md">Change Log</a> ，确保你已经了解新版本的不兼容变化。</li>
<li>如果你要重置之前旧版本上用的参数或者配置一些新参数，建议在 <code>helm upgrade</code> 命令里加上 <code>--reset-values</code>。</li>
</ol>
<h2 id="%E5%8F%AF%E9%80%89%E9%A1%B9">可选项 <a class="header-anchor" href="#%E5%8F%AF%E9%80%89%E9%A1%B9">#</a></h2>
<p>注意直接安装 chart 会使用默认的 template values，你也可以根据你的集群情况指定一些特殊配置，比如修改 resources 限制或者配置 feature-gates。</p>
<h3 id="%E5%8F%AF%E9%80%89%3A-chart-%E5%AE%89%E8%A3%85%E5%8F%82%E6%95%B0">可选: chart 安装参数 <a class="header-anchor" href="#%E5%8F%AF%E9%80%89%3A-chart-%E5%AE%89%E8%A3%85%E5%8F%82%E6%95%B0">#</a></h3>
<p>下表展示了 chart 所有可配置的参数和它们的默认值：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>featureGates</code></td>
<td>可配置的 feature gates 参数，空表示按默认开关处理</td>
<td>``</td>
</tr>
<tr>
<td><code>installation.namespace</code></td>
<td>kruise 安装到的 namespace，一般不建议修改</td>
<td><code>kruise-system</code></td>
</tr>
<tr>
<td><code>manager.log.level</code></td>
<td>kruise-manager 日志输出级别</td>
<td><code>4</code></td>
</tr>
<tr>
<td><code>manager.replicas</code></td>
<td>kruise-manager 的期望副本数</td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>manager.image.repository</code></td>
<td>kruise-manager/kruise-daemon 镜像仓库</td>
<td><code>openkruise/kruise-manager</code></td>
</tr>
<tr>
<td><code>manager.image.tag</code></td>
<td>kruise-manager/kruise-daemon 镜像版本</td>
<td><code>v0.10.0</code></td>
</tr>
<tr>
<td><code>manager.resources.limits.cpu</code></td>
<td>kruise-manager 的 limit CPU 资源</td>
<td><code>100m</code></td>
</tr>
<tr>
<td><code>manager.resources.limits.memory</code></td>
<td>kruise-manager 的 limit memory 资源</td>
<td><code>256Mi</code></td>
</tr>
<tr>
<td><code>manager.resources.requests.cpu</code></td>
<td>kruise-manager 的 request CPU 资源</td>
<td><code>100m</code></td>
</tr>
<tr>
<td><code>manager.resources.requests.memory</code></td>
<td>kruise-manager 的 request memory 资源</td>
<td><code>256Mi</code></td>
</tr>
<tr>
<td><code>manager.metrics.port</code></td>
<td>metrics 服务的监听端口</td>
<td><code>8080</code></td>
</tr>
<tr>
<td><code>manager.webhook.port</code></td>
<td>webhook 服务的监听端口</td>
<td><code>9443</code></td>
</tr>
<tr>
<td><code>manager.nodeAffinity</code></td>
<td>kruise-manager 部署的 node affinity 亲和性</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>manager.nodeSelector</code></td>
<td>kruise-manager 部署的 node selector 亲和性</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>manager.tolerations</code></td>
<td>kruise-manager 部署的 tolerations</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>daemon.log.level</code></td>
<td>kruise-daemon 日志输出级别</td>
<td><code>4</code></td>
</tr>
<tr>
<td><code>daemon.port</code></td>
<td>kruise-daemon 的 metrics/healthz 服务监听端口</td>
<td><code>10221</code></td>
</tr>
<tr>
<td><code>daemon.resources.limits.cpu</code></td>
<td>kruise-daemon 的 limit CPU 资源</td>
<td><code>50m</code></td>
</tr>
<tr>
<td><code>daemon.resources.limits.memory</code></td>
<td>kruise-daemon 的 limit memory 资源</td>
<td><code>128Mi</code></td>
</tr>
<tr>
<td><code>daemon.resources.requests.cpu</code></td>
<td>kruise-daemon 的 request CPU 资源</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>daemon.resources.requests.memory</code></td>
<td>kruise-daemon 的 request memory 资源</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>daemon.affinity</code></td>
<td>kruise-daemon 部署的 affinity 亲和性 (可以排除一些 node 不部署 daemon)</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>daemon.socketLocation</code></td>
<td>Node 节点上 CRI socket 文件所在目录</td>
<td><code>/var/run</code></td>
</tr>
<tr>
<td><code>webhookConfiguration.failurePolicy.pods</code></td>
<td>Pod webhook 的失败策略</td>
<td><code>Ignore</code></td>
</tr>
<tr>
<td><code>webhookConfiguration.timeoutSeconds</code></td>
<td>所有 Kruise webhook 的调用超时时间</td>
<td><code>30</code></td>
</tr>
<tr>
<td><code>crds.managed</code></td>
<td>是否安装 Kruise CRD (如何关闭则 chart 不会安装任何 CRD)</td>
<td><code>true</code></td>
</tr>
</tbody>
</table>
<p>这些参数可以通过 <code>--set key=value[,key=value]</code> 参数在 <code>helm install</code> 或 <code>helm upgrade</code> 命令中生效。</p>
<h3 id="%E5%8F%AF%E9%80%89%3A-feature-gate">可选: feature-gate <a class="header-anchor" href="#%E5%8F%AF%E9%80%89%3A-feature-gate">#</a></h3>
<p>Feature-gate 控制了 Kruise 中一些有影响性的功能：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Default</th>
<th>Side effect (if closed)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PodWebhook</code></td>
<td>启用对于 Pod <strong>创建</strong> 的 webhook (不建议关闭)</td>
<td><code>true</code></td>
<td>SidecarSet/KruisePodReadinessGate 不可用</td>
</tr>
<tr>
<td><code>KruiseDaemon</code></td>
<td>启用 <code>kruise-daemon</code> DaemonSet (不建议关闭)</td>
<td><code>true</code></td>
<td>镜像预热/容器重启 不可用</td>
</tr>
<tr>
<td><code>DaemonWatchingPod</code></td>
<td>每个 <code>kruise-daemon</code> 会 watch 与自己同节点的 pod （不建议关闭）</td>
<td><code>true</code></td>
<td>同 imageID 的原地升级，以及支持 env from labels/annotation 原地升级 不可用</td>
</tr>
<tr>
<td><code>CloneSetShortHash</code></td>
<td>启用 CloneSet controller 只在 pod label 中设置短 hash 值</td>
<td><code>false</code></td>
<td>CloneSet 名字不能超过 54 个字符（默认行为）</td>
</tr>
<tr>
<td><code>KruisePodReadinessGate</code></td>
<td>启用 Kruise webhook 将 'KruisePodReady' readiness-gate 在所有 Pod 创建时注入</td>
<td><code>false</code></td>
<td>只会注入到 Kruise workloads 创建的 Pod 中</td>
</tr>
<tr>
<td><code>PreDownloadImageForInPlaceUpdate</code></td>
<td>启用 CloneSet 自动为原地升级的过程创建 ImagePullJob 来预热镜像</td>
<td><code>false</code></td>
<td>原地升级无镜像提前预热</td>
</tr>
<tr>
<td><code>CloneSetPartitionRollback</code></td>
<td>启用如果 partition 被调大， CloneSet controller 会回滚 Pod 到 currentRevision 老版本</td>
<td><code>false</code></td>
<td>CloneSet 只会正向发布 Pod 到 updateRevision</td>
</tr>
<tr>
<td><code>ResourcesDeletionProtection</code></td>
<td>资源删除防护</td>
<td><code>false</code></td>
<td>资源删除无保护</td>
</tr>
<tr>
<td><code>TemplateNoDefaults</code></td>
<td>是否取消对 workload 中 pod/pvc template 的默认值注入</td>
<td><code>false</code></td>
<td>Should not close this feature if it has open</td>
</tr>
<tr>
<td><code>PodUnavailableBudgetDeleteGate</code></td>
<td>启用 PodUnavailableBudget 保护 pod 删除、驱逐</td>
<td><code>false</code></td>
<td>不防护 pod 删除、驱逐</td>
</tr>
<tr>
<td><code>PodUnavailableBudgetUpdateGate</code></td>
<td>启用 PodUnavailableBudget 保护 pod 原地升级</td>
<td><code>false</code></td>
<td>不防护 pod 原地升级</td>
</tr>
<tr>
<td><code>WorkloadSpread</code></td>
<td>启用 WorkloadSpread 管理应用多分区弹性与拓扑部署</td>
<td><code>false</code></td>
<td>不支持 WorkloadSpread</td>
</tr>
</tbody>
</table>
<p>如果你要配置 feature-gate，只要在安装或升级时配置参数即可，比如：</p>
<pre><code class="language-bash">$ helm install kruise https://... --<span class="hljs-built_in">set</span> featureGates=<span class="hljs-string">"ResourcesDeletionProtection=true\,PreDownloadImageForInPlaceUpdate=true"</span>
</code></pre>
<p>如果你希望打开所有 feature-gate 功能，配置参数 <code>featureGates=AllAlpha=true</code>。</p>
<h3 id="%E5%8F%AF%E9%80%89%3A-%E4%B8%AD%E5%9B%BD%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F">可选: 中国本地镜像 <a class="header-anchor" href="#%E5%8F%AF%E9%80%89%3A-%E4%B8%AD%E5%9B%BD%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F">#</a></h3>
<p>如果你在中国、并且很难从官方 DockerHub 上拉镜像，那么你可以使用托管在阿里云上的镜像仓库：</p>
<pre><code class="language-bash">$ helm install kruise https://... --<span class="hljs-built_in">set</span>  manager.image.repository=openkruise-registry.cn-hangzhou.cr.aliyuncs.com/openkruise/kruise-manager
</code></pre>
<h2 id="%E5%8D%B8%E8%BD%BD">卸载 <a class="header-anchor" href="#%E5%8D%B8%E8%BD%BD">#</a></h2>
<p>注意：卸载会导致所有 Kruise 下的资源都会删除掉，包括 webhook configurations, services, namespace, CRDs, CR instances 以及所有 Kruise workload 下的 Pod。 请务必谨慎操作！</p>
<p>卸载使用 helm chart 安装的 Kruise：</p>
<pre><code class="language-bash">$ helm uninstall kruise
release <span class="hljs-string">"kruise"</span> uninstalled
</code></pre>
</div></section><footer class="footer-container"><div class="cloud-native"><div class="container"><img src="https://d33wubrfki0l68.cloudfront.net/ea0d91fac8683c38ea9a1fb8a4e9914627ac6aae/8efa9/img/logos/cloud-native-computing.svg"/><p>We are a <a href="https://www.cncf.io">Cloud Native Computing Foundation</a> sandbox project.</p></div></div><div class="copyright"><span>Copyright © 2021 The OpenKruise Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage">https://www.linuxfoundation.org/trademark-usage</a></span></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>